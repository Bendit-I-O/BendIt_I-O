<!doctype html>
<html>

<head>

    <!-- <script src="/libraries/nexusUI/dist/nexusUI.min.js"></script> -->
    <script src="/libraries//NexusUI.js"></script>

    <title>Bendit_I/O Simple Controller</title>
    <style>
        body {
            background: rgb(255, 230, 161);
            padding: 10px 0;
        }

        .device1controls {
            float: left;
            width: 450px;
        }

        .device2controls {

            width: 450px;
            float: left;

        }

        .device1buttongird {
            display: inline-block;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            width: 400px;

            padding: 5px 0;
        }

        .device2buttongird {
            display: inline-block;
            font-family: 'Trebuchet MS', 'Lucida Sans Unicode', 'Lucida Grande', 'Lucida Sans', Arial, sans-serif;
            width: 600px;

            padding: 5px 0;
        }
    </style>
</head>

<body>


    <div class="device1controls">
        <div class="device1buttongird" id="toggleButton1"></div>
        <div class="device1buttongird" id="toggleButton2"></div>
        <div class="device1buttongird" id="toggleButton3"></div>
        <div class="device1buttongird" id="toggleButton4"></div>


        <div class="device1buttongird" id="toggleButton5"></div>
        <div class="device1buttongird" id="toggleButton6"></div>
        <div class="device1buttongird" id="metroButtonSw1"></div>
        <div class="device1buttongird" id="metroStopSw1"></div>
        <br></br>
        <div class="device1buttongird" id="metro1SpeedSlider"></div>
        <br></br>
        <div class="device1buttongird" id="metroButtonSw2"></div>
        <div class="device1buttongird" id="metroStopSw2"></div>
        <br></br>
        <div class="device1buttongird" id="metro2SpeedSlider"></div>
        <br></br>
        <div class="device1buttongird" id="potButton"></div>
        <div class="device1buttongird" id="potPositionSlider"></div>



    </div>


    <div class="device2controls">

        <div class="device2buttongird" id="2_toggleButton1"></div>
        <div class="device2buttongird" id="2_toggleButton2"></div>
        <div class="device2buttongird" id="2_toggleButton3"></div>
        <div class="device2buttongird" id="2_toggleButton4"></div>


        <div class="device2buttongird" id="2_toggleButton5"></div>
        <div class="device2buttongird" id="2_toggleButton5_label">Mute Latch</div>
        <div class="device2buttongird" id="2_toggleButton6"></div>
        <br></br>
        <div class="device2buttongird" id="2_metroButtonSw1"></div>
        <div class="device2buttongird" id="2_metroStopSw1"></div>
        <br></br>
        <div class="device2buttongird" id="2_metro1SpeedSlider"></div>
        <br></br>
        <div class="device2buttongird" id="2_metroButtonSw2"></div>
        <div class="device2buttongird" id="2_metroStopSw2"></div>
        <br></br>
        <div class="device2buttongird" id="2_metro2SpeedSlider"></div>

    </div>
    <!-- <div class="slidecontainer1">
        <p>Switch 1 Metro Speed:</p>
        <input type="range" min="250" max="2000" value="250" step="250" class="slider" id="metroSpeedSlider">
        <p>Metro Speed: <span id="metroSpeedValue"></span></p>
    </div> -->
    <!-- 
<div class="slidecontainer2">
    <p>Switch 2 Metro Speed:</p>
    <input type="range" min="250" max="2000" value="250" step="250" class="slider" id="metroSpeedSlider2">
    <p>Metro Speed: <span id="metroSpeed2Value"></span></p>
</div> -->


    <script src="/socket.io/socket.io.js"></script>
    <script src="http://code.jquery.com/jquery-1.11.1.js"></script>


    <script>
        /*
        Bendit_I/O: Wireless Circuit Bending

            Example Performance: Web Controller Interface

                *** Work in Progress ***

                Anthony T.Marasco - 2019

        */

        var socket = io();


        var dev1_dial1 = new Nexus.Dial('#metro1SpeedSlider', {
            'size': [100, 100],
            'interaction': 'radial',
            'min': 250,
            'max': 2000,
            'step': 250
        });
        var dev1_dial2 = new Nexus.Dial('#metro2SpeedSlider', {
            'size': [100, 100],
            'interaction': 'radial',
            'min': 0,
            'max': 255,
            'step': 1
        });

        // var dev1_dial3 = new Nexus.Dial('#potPositionSlider', {
        //         'size': [100, 100],
        //         'interaction': 'radial',
        //         'min': 0,
        //         'max': 255,
        //         'step': 1
        //     });

        let metroSpeed = 250;
        let metro2Speed = 250;
        let metroSpeed_2 = 250;
        let metro2Speed_2 = 250;
        let pot1Position = 0;

        let pbclickCount = 0;
        let espclickCount = 0;
        let playPauseState;
        let espState;
        let playingOrPausing;

        var pb1 = new Nexus.TextButton('#toggleButton1', {
            'size': [150, 50],
            'state': false,
            'text': 'Play',
            'alternateText': 'Pause'
        });

        var sb1 = new Nexus.TextButton('#toggleButton2', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop'
        });

        var ffb1 = new Nexus.TextButton('#toggleButton3', {
            'size': [150, 50],
            'state': false,
            'text': 'Forward'
        });

        var espb1 = new Nexus.TextButton('#toggleButton4', {
            'size': [150, 50],
            'state': false,
            'text': 'ESP on',
            'alternateText': 'ESP off'
        });

        var pot1 = new Nexus.TextButton('#potButton', {
                'size': [150, 50],
                'state': false,
                'text': 'Set Pot'
            });

        var tb5_1 = new Nexus.Toggle('#toggleButton5', {
            'size': [150, 50],
            'state': false
        });

        var tb6_1 = new Nexus.Toggle('#toggleButton6', {
            'size': [150, 50],
            'state': false
        });

        var metroStart1 = new Nexus.TextButton('#metroButtonSw1', {
            'size': [150, 50],
            'state': false,
            'text': 'Start Metro 1'
        });

        var metroStop1 = new Nexus.TextButton('#metroStopSw1', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop Metro 1'
        });

        var metroStart2 = new Nexus.TextButton('#metroButtonSw2', {
            'size': [150, 50],
            'state': false,
            'text': 'Start Metro 2'
        });
        var metroStop2 = new Nexus.TextButton('#metroStopSw2', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop Metro 2'
        });

        //Device 2 buttons and dials
        Nexus.colors.accent = "#FFA07A";

        var dev2_dial1 = new Nexus.Dial('#2_metro1SpeedSlider', {
            'size': [100, 100],
            'interaction': 'radial',
            'min': 250,
            'max': 2000,
            'step': 250
        });

        var dev2_dial2 = new Nexus.Dial('#2_metro2SpeedSlider', {
            'size': [100, 100],
            'interaction': 'radial',
            'min': 250,
            'max': 2000,
            'step': 250
        });


        var pb1_2 = new Nexus.TextButton('#2_toggleButton1', {
            'size': [150, 50],
            'state': false,
            'text': 'Play',
            'alternate': 'Pause'
        });


        var sb1_2 = new Nexus.TextButton('#2_toggleButton2', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop'
        });

        var ffb1_2 = new Nexus.TextButton('#2_toggleButton3', {
            'size': [150, 50],
            'state': false,
            'text': 'Forward'
        });

        var espb1_2 = new Nexus.TextButton('#2_toggleButton4', {
            'size': [150, 50],
            'state': false,
            'text': 'ESP off',
            'alternate': 'ESP on'
        });

        var tbLatch_1_2 = new Nexus.Toggle('#2_toggleButton5', {
            'size': [150, 50],
            'state': false
        });

        var tb6_1_2 = new Nexus.Toggle('#2_toggleButton6', {
            'size': [150, 50],
            'state': false
        });

        var metroStart1_2 = new Nexus.TextButton('#2_metroButtonSw1', {
            'size': [150, 50],
            'state': false,
            'text': 'Start Metro 1'
        });

        var metroStop1_2 = new Nexus.TextButton('#2_metroStopSw1', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop Metro 1'
        });

        var metroStart2_2 = new Nexus.TextButton('#2_metroButtonSw2', {
            'size': [150, 50],
            'state': false,
            'text': 'Start Metro 2'
        });
        var metroStop2_2 = new Nexus.TextButton('#2_metroStopSw2', {
            'size': [150, 50],
            'state': false,
            'text': 'Stop Metro 2'
        });


        pb1.on('click', function (v) {
            pbclickCount++;
            playPauseState = (pbclickCount - 1) % 2;
            if (playPauseState == 0) {
                playingOrPausing = 0;
            } else {
                playingOrPausing = 1;
            }
            socket.emit('toggle1', {
                state: true,
                device: 1
            });

            socket.emit('message', playPauseState);
            socket.emit('playPauseMessage', playingOrPausing);
            // setTimeout(function () {
            //     socket.emit('toggle1', {
            //         state: false,
            //         device: 1
            //     });
            // }, 100);
        });

        pb1.on('release', function (v) {
            socket.emit('toggle1', {
                state: false,
                device: 1
            });
        });

        sb1.on('click', function (v) {
            socket.emit('toggle2', {
                state: true,
                device: 1
            });

            // setTimeout(function () {
            //     socket.emit('toggle2', {
            //         state: false,
            //         device: 1
            //     });
            // }, 200);
        });

        sb1.on('release', function (v) {
            socket.emit('toggle2', {
                state: false,
                device: 1
            });
        });

        ffb1.on('click', function (v) {
            socket.emit('toggle3', {
                state: true,
                device: 1
            });

            socket.emit('message', "ffDown");

        });

        ffb1.on('release', function (v) {
            socket.emit('toggle3', {
                state: false,
                device: 1
            });
            socket.emit('message', "ffUp");
        });

        espb1.on('change', function () {
            espclickCount++;
            espState = espclickCount % 2;
            socket.emit('toggle4', {
                state: true,
                device: 1
            });
            setTimeout(function () {
                socket.emit('toggle4', {
                    state: false,
                    device: 1
                });
            }, 200);

            socket.emit('espMessage', espState);
        });



        tb5_1.on('change', function (v) {

            socket.emit('toggle5', {
                state: v,
                device: 1
            });





        });

        tb6_1.on('change', function (v) {

            let bendTogState;

            if (tb6_1.state == true) {
                bendTogState = "bend1";
            } else {
                bendTogState = "unbend1";
            }

            socket.emit('message', bendTogState);

            

            socket.emit('toggle6', {
                state: v,
                device: 1
            });
        });

        metroStart1.on('release', function () {
            socket.emit('metroSw1Start', {
                time: metroSpeed,
                device: 1
            });
        });

        metroStop1.on('release', function () {
            socket.emit('metroSw1Stop', {
                device: 1
            });
            //console.log("Device: " + data.device + "switch 1 metro stopped");
        });

        metroStart2.on('release', function () {
            socket.emit('metroSw3Start', {
                time: metro2Speed,
                device: 1
            });
        });

        metroStop2.on('release', function () {
            socket.emit('metroSw3Stop', {
                device: 1
            });
        });

        // 

        dev1_dial1.on('change', (v) => {
        metroSpeed = v;
        });

        dev1_dial2.on('change', (v) => {
            // metro2Speed = v;
            pot1Position = v;
            


        });

        //    dev1_dial3.on('change', (v) => {
        //         pot1Position = v;
        //     });

        //Device 2 Controls!
        pb1_2.on('click', function (v) {
            socket.emit('toggle1', {
                state: true,
                device: 2
            });
        });



        pb1_2.on('release', function (v) {
            socket.emit('toggle1', {
                state: false,
                device: 2
            });
        });

        sb1_2.on('click', function (v) {
            socket.emit('toggle2', {
                state: true,
                device: 2
            });

        });


        sb1_2.on('release', function (v) {
            socket.emit('toggle2', {
                state: false,
                device: 2
            });

        });

        ffb1_2.on('click', function (v) {
            socket.emit('toggle3', {
                state: true,
                device: 2
            });


        });

        ffb1_2.on('release', function (v) {
            socket.emit('toggle3', {
                state: false,
                device: 2
            });
        })
        // //swapping toggle4 and toggle5 events between these two buttons due to wiring change on CD player 2
        espb1_2.on('change', function () {
            socket.emit('toggle5', {
                state: true,
                device: 2
            });
            setTimeout(function () {
                socket.emit('toggle5', {
                    state: false,
                    device: 2
                });
            }, 200);
            // 
        });

        tbLatch_1_2.on('change', function (v) {
            socket.emit('toggle4', {
                state: v,
                device: 2
            });
        });

        tb6_1_2.on('change', function (v) {
            socket.emit('toggle6', {
                state: v,
                device: 2
            });
        });


pot1.on('click', function (v) {
socket.emit('potTurning', {
position: pot1Position,
device: 2
});
 });



 


        // metroStart1_2.on('release', function () {
        //     socket.emit('metroSw1Start', {
        //         time: metroSpeed_2,
        //         device: 2
        //     });
        // });

        // metroStop1_2.on('release', function () {
        //     socket.emit('metroSw1Stop', {
        //         device: 2
        //     });
        //     //console.log("Device: " + data.device + "switch 1 metro stopped");
        // });

        // metroStart2_2.on('release', function () {
        //     socket.emit('metroSw3Start', {
        //         time: metro2Speed_2,
        //         device: 2
        //     });
        // });

        // metroStop2_2.on('release', function () {
        //     socket.emit('metroSw3Stop', {
        //         device: 2
        //     });
        // });
        // //Example of using vanilla JS to do this:
        // //     document.getElementById('toggleButton1').addEventListener('click', function () {
        // //         socket.emit('toggle1', { state: true, device: 1 });
        // //    });


        // dev2_dial1.on('change', (v) => {
        //     metroSpeed_2 = v;
        // });

        // dev2_dial2.on('change', (v) => {
        //     metro2Speed_2 = v;
        // });

        // document.getElementById('potButton').addEventListener('click', function () {
        //     socket.emit('potTurning', {
        //         position: 200,
        //         device: 1
        //     });
        // })
        socket.on('message', function (data) {
            console.log(data);
        })
        // document.getElementById('device_2_toggleButton1').addEventListener('click', function () {
        //     socket.emit('toggle1', {
        //         state: true,
        //         device: 2
        //     });
        // });
    </script>
</body>

</html>